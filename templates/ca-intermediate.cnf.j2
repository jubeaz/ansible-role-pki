{{ ansible_managed | comment }}
# config used to sign intermediate ca certificates

.include {{ _ca_dirs['_ca_cnf'].path }}/openssl-base.cnf

[ ca ]
default_ca              = CA_default

[ CA_default ]
dir                     = $b_dir
certs                   = $b_certs
new_certs_dir           = $b_new_certs_dir
private_dir             = $b_private_dir

database                = $b_database
serial                  = $b_serial
RANDFILE                = $b_RANDFILE

private_key             = $b_private_key
certificate             = $b_certificate

default_md              = {{ ca_intermediate_info['default_md'] }}
name_opt                = multiline, -esc_msb, utf8
cert_opt                = ca_default
default_days            = {{ ca_intermediate_info['default_days'] }}
email_in_dn             = no
policy                  = strict
preserve                = no
unique_subject          = no
copy_extensions         = copy
x509_extensions         = v3_intermediate_ca

[ strict ]

commonName              = supplied
{% for key, value in ca_intermediate_info['policy'].items() %}
{{ key }} = {{ value }}
{% endfor %}

[ v3_intermediate_ca ]

subjectKeyIdentifier    = hash
authorityKeyIdentifier  = keyid:always,issuer
basicConstraints        = critical, CA:true, pathlen:0
keyUsage                = critical, cRLSign, keyCertSign

crlDistributionPoints   = crldp
certificatePolicies     = @policies
authorityInfoAccess     = @issuer_info

[policies]

policyIdentifier       = 1.3.5.8
CPS.1                  = $b_cps
userNotice.1           = @notice

[notice]

explicitText           = $b_cps_explicit
organization           = $b_cps_organization
noticeNumbers          = 1,2,3,4

[ crldp ]

fullname                = $b_crldp_uri
reasons                 = keyCompromise, CACompromise

[ issuer_info ]

caIssuers;URI.0         = $b_aia_uri
OCSP;URI.0              = $b_ocsp_uri
